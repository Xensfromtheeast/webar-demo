<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Entumo AR — Agendas & Directions</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />

  <!-- A-Frame + AR.js (marker & GPS tracking) -->
  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
  <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/fcor/arjs-gestures/dist/gestures.js"></script>

  <style>
    body, html { margin: 0; overflow: hidden; font-family: 'Poppins', sans-serif; }
    #menu, #helpPanel { position: absolute; z-index: 10; background: rgba(0,0,0,0.7); border-radius: 10px; color: white; padding: 10px; }
    #menu { top: 10px; left: 10px; display: none; }
    #helpPanel { bottom: 10px; left: 10px; width: 300px; display: none; }
    .icon-btn { background: none; border: none; margin: 5px; cursor: pointer; }
    .icon-btn img { width: 60px; height: 60px; border-radius: 50%; }
    #openMenu, #openHelp, #enterVR {
      position: absolute; z-index: 15; bottom: 15px;
      padding: 10px 15px; border-radius: 10px; font-weight: bold; cursor: pointer;
      border: none; color: white;
    }
    #openMenu { left: 15px; background: #007bff; }
    #openHelp { left: 120px; background: #555; }
    #enterVR { right: 15px; background: #00cc66; }
  </style>
</head>

<body>
  <!-- A-FRAME AR SCENE -->
  <a-scene
    embedded
    vr-mode-ui="enabled: true"
    renderer="logarithmicDepthBuffer: true;"
    arjs="sourceType: webcam; debugUIEnabled: false;"
    gesture-detector
  >

    <!-- Camera (with GPS support) -->
    <a-camera gps-camera rotation-reader></a-camera>

    <!-- Marker-based AR agendas -->
    <!-- Stage 1 -->
    <a-marker type="hiro" id="marker-onguan">
      <a-plane src="assets/images/agenda_stage1.png" width="1" height="1.414" rotation="-90 0 0"
        gesture-handler>
      </a-plane>
    </a-marker>

    <!-- Stage 2 -->
    <a-marker type="hiro" id="marker-nabo">
      <a-plane src="assets/images/agenda_stage2.png" width="1" height="1.414" rotation="-90 0 0"
        gesture-handler>
      </a-plane>
    </a-marker>

    <!-- Podcast Room -->
    <a-marker type="hiro" id="marker-boardroom">
      <a-plane src="assets/images/agenda_podcast.png" width="1" height="1.414" rotation="-90 0 0"
        gesture-handler>
      </a-plane>
    </a-marker>

    <!-- Example Navigation Arrows (location-based AR) -->
    <a-entity id="arrow1"
      gltf-model="assets/models/arrow.glb"
      gps-entity-place="latitude: -0.718500; longitude: 36.432100;"
      scale="1 1 1"
      look-at="[gps-camera]">
    </a-entity>

    <a-entity id="arrow2"
      gltf-model="assets/models/arrow.glb"
      gps-entity-place="latitude: -0.718600; longitude: 36.432200;"
      scale="1 1 1"
      look-at="[gps-camera]">
    </a-entity>

  </a-scene>

  <!-- UI BUTTONS -->
  <button id="openMenu">☰ Menu</button>
  <button id="openHelp">❔ Help</button>
  <button id="enterVR">VR Mode</button>

  <!-- HIDDEN MENUS -->
  <div id="menu">
    <h3>Select Location</h3>
    <button class="icon-btn" data-room="stage1">
      <img src="assets/icons/1.png" alt="Stage 1">
      <span>Stage 1</span>
    </button>
    <button class="icon-btn" data-room="stage2">
      <img src="assets/icons/2.png" alt="Stage 2">
      <span>Stage 2</span>
    </button>
    <button class="icon-btn" data-room="podcast">
      <img src="assets/icons/mic.png" alt="Podcast Room">
      <span>Podcast Room</span>
    </button>
  </div>

  <div id="helpPanel">
    <h3>How to Use</h3>
    <ul>
      <li>Scan any room marker to view its agenda.</li>
      <li>Pinch to zoom and drag to rotate the agenda.</li>
      <li>Tap an icon to view navigation arrows.</li>
      <li>Use "VR Mode" for headset view.</li>
      <li>GPS + Compass required for navigation.</li>
    </ul>
  </div>

  <!-- SCRIPT LOGIC -->
  <script>
    // Toggle Menu
    document.getElementById('openMenu').onclick = () => {
      const menu = document.getElementById('menu');
      menu.style.display = (menu.style.display === 'none' || menu.style.display === '') ? 'block' : 'none';
    };

    // Toggle Help
    document.getElementById('openHelp').onclick = () => {
      const help = document.getElementById('helpPanel');
      help.style.display = (help.style.display === 'none' || help.style.display === '') ? 'block' : 'none';
    };

    // VR Mode button
    document.getElementById('enterVR').onclick = () => {
      const scene = document.querySelector('a-scene');
      scene.enterVR();
    };

    // Navigation logic (switch visible arrows)
    const allArrows = [document.getElementById('arrow1'), document.getElementById('arrow2')];
    const menuButtons = document.querySelectorAll('.icon-btn');

    menuButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const room = btn.dataset.room;
        allArrows.forEach(a => a.setAttribute('visible', false)); // hide all arrows

        if (room === 'stage1') {
          document.getElementById('arrow1').setAttribute('visible', true);
        } else if (room === 'stage2') {
          document.getElementById('arrow2').setAttribute('visible', true);
        } else if (room === 'podcast') {
          // You can later add a 3rd arrow here for the podcast path
          alert("Podcast navigation coming soon!");
        }
      });
    });
  </script>
</body>
</html>

